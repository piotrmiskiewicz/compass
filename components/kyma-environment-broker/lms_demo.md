# LMS integration


1. Kyma Environment Broker receives
```json
{
    "service_id": "47c9dcbf-ff30-448e-ab36-d3bad66ba281",
    "plan_id": "4deee563-e5ec-4731-b9b1-53b42d855f0c",
    "context": {
        "globalaccount_id": "3e64ebae-38b5-46a0-b1ed-9ccee153a0ae",
        "subaccount_id": "some-subaccount-id"
    },
    "parameters": {
        "name": "my-cluster",
        "components": []
    }
}
```
2. Create or use existing LMS Tenant (Kibana & Elasticsearch cluster) for a given GAId

**"globalaccount_id": "3e64ebae-38b5-46a0-b1ed-9ccee153a0ae"**

3. Requests for certificates and configures Kyma overrides:

```bash
$ kubectl get cm -n kyma-installer logging-installer-config -o yaml
apiVersion: v1
data:
  fluent-bit.backend.forward.host: forward.474e66b3-bef8-4643-a53f-6014ba240c59.lmssap.io
  fluent-bit.backend.forward.port: "8443"
  fluent-bit.backend.forward.tls.ca: LS0tLS1CRUdJTBDRV2JSUZJ1GBQ0FUtS0tk1JSUZvRE3SUJBZ0lVSENxVVlyeU5YbGhOZ2orM0hJUUZ2Q1RBODJBd0RRRUwKQlFBd09URTNNRFVHQTFVRUF4TXVORGMwWlRZMllqTXRZbVZtT0MwME5qUXpMV0UxTTJZdE5qQXhOR0poTWpRdwpZelU1TG14dGMzTmhjQzVwYnpBZUZ3MHlNREEwTVRZeE1ERTJNalphRncwek1EQTBNVFF4TURFMk5UTmFNRGt4Ck56QTFCZ05WQkFNVExqUTNOR1UyTm1JekxXSmxaamd0TkRZME15MWhOVE5tTFRZd01UUmlZVEkwTUdNMU9TNXMKYlhOellYQXVhVzh3Z2dJaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQ0R3QXdnZ0lLQW9JQ0FRQ3QzRXpDdnVqcgorOTFRdTZOVFhUdlI5TW5MTi9GMlcweXVMY1cwVWtaNE9xaTBGU0tsSWphdkhGaUxlM3ozTjhSa3gyanlRQTlCCkRFZk1kOGVveHBHdGNSQUp2cnpQTkxoNWk3RVZtUmtZcXlIZTVxM3VLcE83M1N5K3d5NDRRQjYrRlFpWGhITHAKazlKbTVNWTRSWVFxM2UvaFJLWnpJQmx2QXFabEIyeU5HdldMdm94SXFuNGxhTzBFR0hFNWlMZUVkL3I4ajlyUApIanRBTlhlV0xFRTNqS3M0amVzVWVnQ20ycFJDMVdaVWdhODVIa3JneGVlZS8wS0RhOStVendHeFlIMERWWTNvCnhSOEN1WFlIVWV1Q1JiT3NjMWVLSWdpMW80OVBKWXFzUkZTdWNvcERySjcwNWVFaVNtb2Rvbktyd01LdG52ZFoKd2RKcjh2amNrMCtveFM5Znk2YmdVcldhM202QTZGV0F3NGV0c3pSMzBBQ2RKd1hjaVRmMVQ0ajcrczhaeGJIRgpwVlFuT0JPekJ5cll2TDlESjNvZmE1WVZCaWhXVDlFN0dEU2ZzMW1YdXJTUTUyLytqbDF1Q2liYzdzSWxhSE9WCkZ4M2VLUkN4bXpaMmVEbyt2VysvT0txSTNUaTdYTFFWaHJ3aVZTcWs2K0J0NWVESFhnZ2s0LzJ6cjdxQ0kwZ1YKZzN0ZHpyZnRCVHQ0YzhDQ2xuVVRFV0JQaGtrbis1YVpGaEhFd05DQ05vNjRGUDd4RG1wTEZMN3ZyaVc4YnFEeApsMkFiVElMNTc4Z2lMYVRhZDYzcE8zQ0hEMkRJU3A5UnRXTmFTbzZLZmFxbmR3K3RZcmZvQ2JOM2UyWGhiUktJClFtc3p0bFJLT1VZSDAyaTM4dm8xcW54QzJEK2I4QVFyd3dJREFRQUJvNEdmTUlHY01BNEdBMVVkRHdFQi93UUUKQXdJQkJqQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01CMEdBMVVkRGdRV0JCUTVYL3hmbXlTbTlaMzBKc2dJc2QxTApsNHgvT2pBZkJnTlZIU01FR0RBV2dCUTVYL3hmbXlTbTlaMzBKc2dJc2QxTGw0eC9PakE1QmdOVkhSRUVNakF3CmdpNDBOelJsTmpaaU15MWlaV1k0TFRRMk5ETXRZVFV6WmkwMk1ERTBZbUV5TkRCak5Ua3ViRzF6YzJGd0xtbHYKTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElDQVFBck9uc0pyZTBtdVIyVzRHUndPUU9uNElIN001VkpBeEV4dUdabQozemNLWW5wVURJbXkwUnJ3WlJmK2ZtZ1JxRjlrcHNScTdkNDlnL20yUjBWZDI4WGVPV3NWb3hrSEhhTGxFKzRGCnF6dEl6UHdNL3ZVUm01SzJkSmd5dkNZbEI1bDN4SnlmaEF1Y3p2bUpTTzFNQk5aSVBTNE1QM1FHeWRQVHdpMHkKTENCcW9LYTQrWUtmY0M3eWZJWGVsTTYxRXdYTG9GOFZzSVlMSmVBdHkwMy9iREJ6dDk4aVJUR0xUWHoyeWdNZQpxeS9SUGJqb2kwWWtYREpLSUY3OXByOEpUeUVZSG93RU1ZR2dRbERkSWh5c2J3T1BlcGZ6Qi9ZVHAwb0JveGdjCnd2S1FRZ0VhOWN0QU5hNVk2VzlUMEphdnkxdzNmOVVLeFNVOUNjVGlhclMrNENWbnlRb1NIYk9abEdJSXBsRHoKT29tUlYrRXJEZnpDOHlIbU96V2R5ejN1UTJSR3U4cy8xYUE1cngzT091VDQyNXNiVEdCWjFsUEN2Zm02dkJuWApyQW81Wk1qcGpxemZXUTZtY0N4UWhlaDJRdG1neDlCekhKMWNnZnBVNFMwN2VTaE4wQzlJZnN6WE5iTzRzVFVzCklHUHRrK3VJclc5cXo1cmtEbEJsZ3YzNWw0UzV3UzRzeFQ0eEpyRWRNS05mSDlOZTRZcW5FMjZ6MTV2YlNxa0cKVlZFYXJ0UnR0aHc4YjdjQ0xxU01abUFaMi9kUUtWbXBHVDdGTk10NGJ0aVg4RXQyR1oxenpFNWlpODgzdk5VMQpvUU9rVFR0R3VXUjJDVUVFZnovNHNmWFJmZlV2VmwwZzBsYUovOGNvQm1SK1NTSFd0aXdCbXQ2dW1tWUR3ZWR5CkkwUUdQUT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  fluent-bit.backend.forward.tls.cert: LS0tLS2CRUJTiBDRVUSUZJUABCR0tLS0Ck1JSUZFRENDQXZpZ0o0am9QNHM0dUhsdWpjMitjQ3JSUS9GRVp3d0pLb1pJaHZjTkFRRUd09URTNNRFVHQTFVRUF4TXVORGMwWlRZMllqTXRZbVZtT0MwME5qUXpMV0UxTTJZdE5qQXhOR0poTWpRdwpZelU1TG14dGMzTmhjQzVwYnpBZUZ3MHlNREEwTWpBd05EQTJNVGxhRncweU1UQTBNakF3TkRFMk5EbGFNQlF4CkVqQVFCZ05WQkFNVENXWnNkV1Z1ZEdKcGREQ0NBU0l3RFFZSktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0MKZ2dFQkFMakJpWTZFaDJMWXRML3lTcTA5cnJxWnRXajlWTWpYTnJad2xnclFqc09uWjJOVENKY3d5ZTZVcUNUUQpQVEt5UEFRQjlablVFL3BwSEgxdGpVNnRkU1d2cFJxQ01RLzdBYU1hVHpKc0hjcUc0aHRXMWVlSTU0V2NjQWs4Cm5pYkpwcGQ1c2pJYWJVbXFKOGZBNGNVVi9Td2xCd3U2VEVrc1F2WmdJYzNvRjhFbWRmbUZiTGUxMEpac0NKWk8Kam4yNnQ2ZG9hOThzL1B4Rko4YmEzNkhPQnVLWTA0WW01U3dqV0g5QjM0M0tZZ04xVzA5VWVlOEYrZ1BIRjZDUwowSXVUVXBSMTMxaU8wSXBxbXZlREViSllSNlA3TWJLU0hhUUZQYU9PTXZmdGJ6UTVDQnlPZUQ0aWl1Q0k2dFZyClZTMkFQdGx2Z0l5aDF2MXRxSzV0WW1yNGRnc0NBd0VBQWFPQ0FUTXdnZ0V2TUE0R0ExVWREd0VCL3dRRUF3SUQKcURBZEJnTlZIU1VFRmpBVUJnZ3JCZ0VGQlFjREFRWUlLd1lCQlFVSEF3SXdIUVlEVlIwT0JCWUVGTXNnUXdTbAoyUmdqNXdtaUNEakFKRC8vY1I1RU1COEdBMVVkSXdRWU1CYUFGRGxmL0YrYkpLYjFuZlFteUFpeDNVdVhqSDg2Ck1GZ0dDQ3NHQVFVRkJ3RUJCRXd3U2pCSUJnZ3JCZ0VGQlFjd0FvWThhSFIwY0RvdkwyTmtjQzQwTnpSbE5qWmkKTXkxaVpXWTRMVFEyTkRNdFlUVXpaaTAyTURFMFltRXlOREJqTlRrdWJHMXpjMkZ3TG1sdkwyTmhNQlFHQTFVZApFUVFOTUF1Q0NXWnNkV1Z1ZEdKcGREQk9CZ05WSFI4RVJ6QkZNRU9nUWFBL2hqMW9kSFJ3T2k4dlkyUndMalEzCk5HVTJObUl6TFdKbFpqZ3RORFkwTXkxaE5UTm1MVFl3TVRSaVlUSTBNR00xT1M1c2JYTnpZWEF1YVc4dlkzSnMKTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElDQVFBWE5va0hsbXJNczhBSTdRamJvMnpycGxSa3Jrd3lrSTh0V3o3OAptL00xcmlqQmx3QTdxUDBNT3BmZVF5OGtwQ3p6dm5CNlRjTmFlcGNDajhrQmJrYS84dTZMcHlwT2tLTGNtWmhNCjN5T3pjRnlCT05LdTdGTnhwYmNqSHY5TXdPZXBSZkR6ZnFMeGxnZDBXZWF0RjFWb0k3SFVCbUU0bHY1VGVya3UKSGJxTmVhdW94NXFYUE45NjJyNGhyRmg5OWV2TzdzNy9hOHNoMUxXQ21sQURnYzRZQXRYVlFZcnVhSnRUS0lWSwp2aHRNbzJ0VVAvSVZXVnl0cjdFVmN2ZUFHNUtHa1FGa0thbTBxTjB3cHk0SzFCc0UzTWJNbFkvdEZDd2JrdzROClgyanRIWWhnRGZ2K0JXbU1VcTY3RXIzRHFLUUdudlljK0VIdm5JWVRxUVVkQlpwcWUrNklzeThERDdqWHBWODMKRXFrdTdsNmNVWXM1TzBTRy9zT0xUVTBLWU1GK1dyUkk4Ly9Lb05YZEJ4Q0JBQ3Blelp5ZkdINXhlQWZWQUo0YQpTUEJtb3c5c3A1d0R5dUZIOTVVaVBWOGRSZVYycFhkZmR5blhEcCtxU2xpZW13RmF4L3MvYjZPTkxxOG1zVHlrCis3bzJKT1lyaE1CSTI4Y2ZvWkNzeFV4MTg2TFJ2bkIvZ0pRZWM5Q1oxRjlFUUNLNXNzT1Q2QVhVRWRyd1NEKzQKOXFneFhGT3h0ZWROdi9QNjJIMEhKOXZpUlZISlRQbmYzVjlxbnJnVXFORnpDQnJEMHBTSzdyKy9JMU1mZWx1Ygpyb3lDZVZwWFRaOXR6Z0FFUHlHam5pMjVHMHJjYnNSaExhYllTbng3Q2RSZENUUHFyaG1uS3BSRFBCa2hVUDVwClhBeGRuUT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  fluent-bit.backend.forward.tls.enabled: "true"
  fluent-bit.backend.forward.tls.key: LS0tLS1RUJTiBU1EgUFJJVkFUSBLRVktLS0tLQpNSlFcEFJQkF1HSmpvU0hZdGkwdi9KS3JUMnV1cOYzJ0bkNXQ3RDT3c2ZG5Zmx6REo3cFNvSk5BOU1ySThCQUgxbWRRVCtta2NmVzJOVHExMUphK2xHb0l4RC9zQm94cFBNbXdkeW9iaUcxYlYKNTRqbmhaeHdDVHllSnNtbWwzbXlNaHB0U2Fvbng4RGh4Ulg5TENVSEM3cE1TU3hDOW1BaHplZ1h3U1oxK1lWcwp0N1hRbG13SWxrNk9mYnEzcDJocjN5ejgvRVVueHRyZm9jNEc0cGpUaGlibExDTllmMEhmamNwaUEzVmJUMVI1Cjd3WDZBOGNYb0pMUWk1TlNsSFhmV0k3UWltcWE5NE1Sc2xoSG8vc3hzcElkcEFVOW80NHk5KzF2TkRrSUhJNTQKUGlLSzRJanExV3RWTFlBKzJXK0FqS0hXL1cyb3JtMWlhdmgyQ3dJREFRQUJBb0lCQUczcXhybkJZd0tOeHN0RApqT1lRZ25tRnBRWDNZWSt6YWx1VUU5QVBVRUJhd2dtM2hxN2NXZWJWRGt3SWo4QXZoY0Vrb1VlSmd2RkJ3NjlqCmsrUXhFamIvam94ODFFK2JsOWUvZVVxWVJBa1B3a2xkbWhrTHZDSWpkZ3dvd2paMVZlVmNnNFdIYjJtYUQ5eXAKaGloSThyeG1zeEJwSDZXUTdhM0NkNW9XOExyNThESzlVYjcyYVdiUy9xa3I5NjFHeWUwbzlwQmgzOVlrTk9KSAp3cFpKMzBvUFJkdEllK09IQ1YvWm1YdlU4YnYzYlhSUnloSlB3MUJ2bTVEUGVPL0doakxyMnpoK25QV1czbVBlCnZJZzFqVVA2OXdHcnBkVkNyM3pwVGZUZXkyTG1qR3gxOTZHTXFwUGQyY3QzUFhYSFl6aVp0WjlZcmRrV0lOQ3IKN3p1OGNsRUNnWUVBd1RHZWtUY1RHVDdETWlrSFJmNkVyZ2NlZ0pNdm0vTUxKOVBsWTBWdXNaYzhpZklqaitvYgpvdjN5VHBJemE3RjF0c09rOTNoaC9XQ3VBZGNWOG0wNFd3ZnVvY0UzZm9wSnJSbkhUbS92WDl0V2FRdGN1WXZLClVTWVIxdm5EK295YUg4ekw5TGZEa2YrSkhQU04zbmhqRDVobFBoT0xUd1JHanc5bjV5b3FxRDhDZ1lFQTlOR3cKSHpHaWtjQnlaY0hEU3N6R3RwOHVDdWlvNEQzUmR6dXFDZ2w3bnhGb1BObWJyWWM5bFBqdTIwK3JHSUpKOVVlOApFdSt6bmFzVGNFTEcrK0V4Si82MCtoZTBDOEltRTY0akliOTh5a0VCbEFFbjBQTU5JUXVkNE9qUmRaYlFFRG1UCitaRlkxc0p6ejR6eWtyeVg2emd1NitwMnluVyt5SlM4QmlrOEh6VUNnWUJkQ05BYmpqSWNUaVVoMnJBdC9NdFkKSXdXRlZWdnY5YkxCazBFNzlRdkJhZHMxY3UyOU9EZm0zZlA1OGwzZzFxeWhQc1lLaG1acDVremxoZmFEc0NVYgpjVTV4aHVKNmhZM0ZWa3lzY1NzTk5rcitld0pFT0JWTnpzOTRmdjdwZ1J3WGhFQVRzUXIxRytHam1BRlp5UStyClN2QTJYS01SZ2pXWVh3cmlQMlFiY1FLQmdRRElyUGtKR002QldwWnJBcURxTjJETFlUK0VnYUdyN2dBOUZCTVYKbHlCV0N4YStpa0VweEttZDYwOGZSZmFoYUdybk81M1doOVZiY0ZmR3RYWVdFVWtSMTU3UlFZeTc5ckR2Z05ZYgpXN01XdHFKc2gyWHp5TWNDUjF0cWVHejVUbDNPYnVQMHRrZDBBb0NicUpWTjRubEV2aEQ0SUlDdkJFVVdkWlNLCkdGTEg0UUtCZ1FDajBDc2x6blpOWElCU00xNWNqWGxRZVdoWW5IdWdnQ3NVU3FYSFdVVjJIa3pPNlp0czN0dlAKRG1RN005SnU4UXJLMWthUi9iTlRpTUZYcnVobjM5TzhLbG1ydWtrUEh5eVVyWFdCZ0k1WkdWcXdSbjZ3UTgzWgpVbTJDRytJMVVyVEZXS3NRMmlTa2ZHVmRYS0lONWJYWjlXVjFIdDZuOER1VlZxTzNERmxuVFE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
  fluent-bit.backend.forward.tls.verify: "On"
  fluent-bit.conf.Input.Kubernetes_loki.exclude.namespaces: kube-node-lease,kube-public,kyma-system,istio-system,knative-eventing,knative-serving,kyma-integration,kube-system,compass-system,kyma-installer
  fluent-bit.conf.Output.forward.enabled: "true"
  fluent-bit.conf.extra: |2

    [FILTER]
            Name record_modifier
            Match *
            Record cluster_name some-subaccount-id
```

then go to 
https://kibana.474e66b3-bef8-4643-a53f-6014ba240c59.lmssap.io/


Filter logs by a cluster:
`cluster_name:some-subaccount-id`

Filter by an app:
`kubernetes.labels.app:apiserver-proxy`

https://github.tools.sap/kyma/backlog/issues/24
https://wiki.hybris.com/display/c4ecs/LMS+Tenant+Provisioning+flow
